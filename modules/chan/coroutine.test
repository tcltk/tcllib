#! /usr/bin/tclsh

source [file join \
	[file dirname [file dirname [file dirname [
	    file normalize [info script]/...]]]]/devtools/testutilities.tcl]

testsNeedTcl     8.6
testsNeedTcltest 2.0

package require {chan base}
package require {chan coroutine}
package require tcl::chan::string 


proc main {} {try {
    variable done

    test chan-coroutine-configure {} -body {
	::tcllib::chan::base new chan1
	::tcllib::chan::coroutine::new chan1
	chan1 .init [::tcl::chan::string \
	    {Curiosity governs the first moment}]
	chan1 read
    } -cleanup {
	rename chan1 {}
    } -result {Curiosity governs the first moment} 

    testsuiteCleanup
} finally {
    set done 1
}}

after 0 coroutine [info cmdcount]_main main  
vwait [namespace current]::done
